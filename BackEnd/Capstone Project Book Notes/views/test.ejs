<%- include("./partials/header.ejs") %>

<div class="box">
  <% for(let book of books){ %>
  <div class="item">
    <form action="/delete-book" method="post">
      <input
        type="checkbox"
        onchange="this.form.submit()"
        name="id"
        onclick="return confirm('Are you sure you want to delete this book?');"
        value="<%= book.id %>"
      />
    </form>

    <p id="title<%= book.id %>"><%= book.title %></p>
    <p>Review: <%= book.review %>/10</p>
    <p><%= book.review_text %></p>

    <% if (book.cover_url) { %>
    <img src="<%= book.cover_url %>" alt="Book Cover" width="150" />
    <% } else { %>
    <p>No Cover Available</p>
    <% } %>

    <!-- Edit Form -->
    <form
      id="editForm<%= book.id %>"
      action="/update-book/<%= book.id %>"
      method="POST"
      class="hidden"
    >
      <input type="text" name="title" value="<%= book.title %>" required />
      <input type="text" name="author" value="<%= book.author %>" required />
      <input
        type="number"
        name="review"
        min="1"
        max="10"
        value="<%= book.review %>"
        required
      />
      <textarea name="review_text" required><%= book.review_text %></textarea>

      <button type="submit" class="done">
        <img class="icon" src="/assets/icons/check-solid.svg" alt="Save" />
      </button>
    </form>

    <button
      id="editBtn<%= book.id %>"
      class="edit"
      onclick="showEditForm('<%= book.id %>')"
    >
      <img class="icon" src="/assets/icons/pencil-solid.svg" alt="Edit" />
    </button>
  </div>
  <% } %>

  <!-- Add New Book -->
  <form action="/add-book" method="POST" class="add-form">
    <label for="title">Book Title:</label>
    <input type="text" id="title" name="title" required />

    <label for="author">Author:</label>
    <input type="text" id="author" name="author" required />

    <label for="review">Review (1-10):</label>
    <input type="number" id="review" name="review" min="1" max="10" required />

    <label for="review_text">Why do you like this book?</label>
    <textarea id="review_text" name="review_text" rows="4"></textarea>

    <button type="submit">Add Book</button>
  </form>
</div>

<script>
  function showEditForm(id) {
    document.getElementById("editForm" + id).classList.remove("hidden");
    document.getElementById("editBtn" + id).classList.add("hidden");
  }
</script>

<%- include("./partials/footer.ejs") %>
